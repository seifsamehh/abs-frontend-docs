---
title: Architecture
description: Project structure, architectural patterns, and design decisions
keywords:
  ["architecture", "project-structure", "patterns", "design", "organization"]
difficulty: intermediate
---

import { Card, Cards } from "fumadocs-ui/components/card";
import { Callout } from "fumadocs-ui/components/callout";
import { Tab, Tabs } from "fumadocs-ui/components/tabs";

# ğŸ—ï¸ Architecture

<Callout type="info">
  This document describes our architectural patterns, project structure, and the
  reasoning behind our technical decisions.
</Callout>

## Architecture Overview

```mermaid
graph TB
    subgraph "Client Layer"
        A[Browser] --> B[Next.js App]
    end

    subgraph "Application Layer"
        B --> C[Pages/Layouts]
        C --> D[Feature Components]
        D --> E[UI Components]
        D --> F[Custom Hooks]
        F --> G[TanStack Query]
    end

    subgraph "Data Layer"
        G --> H[API Client]
        H --> I[REST API / GraphQL]
    end

    subgraph "State Management"
        J[Server State] --> G
        K[Client State] --> L[React Context/Redux]
    end

    style A fill:#0ea5e9,color:#fff
    style B fill:#000,color:#fff
    style G fill:#ff4154,color:#fff
    style I fill:#10b981,color:#fff
```

## Core Principles

<Cards>
  <Card
    title="ğŸ§© Composition over Inheritance"
    description="Build complex functionality by combining simple, focused components"
  />
  <Card
    title="ğŸ¯ Single Responsibility"
    description="Each component, hook, or function has one clear purpose"
  />
  <Card
    title="ğŸ“¦ Feature-Based Organization"
    description="Group code by feature, not by type"
  />
  <Card
    title="ğŸ”„ Separation of Concerns"
    description="Keep UI, logic, and data fetching separate"
  />
</Cards>

## Data Flow Architecture

```mermaid
flowchart LR
    subgraph "User Interaction"
        A[User Action]
    end

    subgraph "React Layer"
        B[Component]
        C[Event Handler]
    end

    subgraph "State Management"
        D{State Type?}
        E[TanStack Query]
        F[Local State]
    end

    subgraph "API Layer"
        G[API Client]
        H[Backend API]
    end

    A --> B
    B --> C
    C --> D
    D -->|Server State| E
    D -->|Client State| F
    E --> G
    G --> H
    H --> G
    G --> E
    E --> B
    F --> B

    style E fill:#ff4154,color:#fff
    style H fill:#10b981,color:#fff
```

## Component Hierarchy

```mermaid
graph TD
    A[App Layout] --> B[Route Layout]
    B --> C[Page Component]
    C --> D[Feature Components]
    D --> E[Shared Components]
    E --> F[UI Primitives]

    subgraph "Server Components"
        A
        B
        C
    end

    subgraph "Client Components"
        D
        E
        F
    end

    style A fill:#0ea5e9,color:#fff
    style B fill:#0ea5e9,color:#fff
    style C fill:#0ea5e9,color:#fff
    style D fill:#f97316,color:#fff
    style E fill:#f97316,color:#fff
    style F fill:#f97316,color:#fff
```

## Project Structure

### Next.js App Router Structure

```
src/
â”œâ”€â”€ app/                          # Next.js App Router
â”‚   â”œâ”€â”€ (auth)/                   # Auth route group
â”‚   â”‚   â”œâ”€â”€ login/
â”‚   â”‚   â”‚   â””â”€â”€ page.tsx
â”‚   â”‚   â””â”€â”€ register/
â”‚   â”‚       â””â”€â”€ page.tsx
â”‚   â”œâ”€â”€ (dashboard)/              # Dashboard route group
â”‚   â”‚   â”œâ”€â”€ layout.tsx            # Shared dashboard layout
â”‚   â”‚   â”œâ”€â”€ page.tsx              # Dashboard home
â”‚   â”‚   â”œâ”€â”€ users/
â”‚   â”‚   â”‚   â”œâ”€â”€ page.tsx          # Users list
â”‚   â”‚   â”‚   â””â”€â”€ [id]/
â”‚   â”‚   â”‚       â””â”€â”€ page.tsx      # User detail
â”‚   â”‚   â””â”€â”€ settings/
â”‚   â”‚       â””â”€â”€ page.tsx
â”‚   â”œâ”€â”€ api/                      # API routes
â”‚   â”‚   â””â”€â”€ auth/
â”‚   â”‚       â””â”€â”€ [...nextauth]/
â”‚   â”‚           â””â”€â”€ route.ts
â”‚   â”œâ”€â”€ layout.tsx                # Root layout
â”‚   â”œâ”€â”€ page.tsx                  # Home page
â”‚   â””â”€â”€ globals.css               # Global styles
â”‚
â”œâ”€â”€ components/
â”‚   â”œâ”€â”€ ui/                       # Base UI components (Shadcn)
â”‚   â”‚   â”œâ”€â”€ button.tsx
â”‚   â”‚   â”œâ”€â”€ card.tsx
â”‚   â”‚   â”œâ”€â”€ input.tsx
â”‚   â”‚   â””â”€â”€ ...
â”‚   â”œâ”€â”€ layout/                   # Layout components
â”‚   â”‚   â”œâ”€â”€ header.tsx
â”‚   â”‚   â”œâ”€â”€ sidebar.tsx
â”‚   â”‚   â””â”€â”€ footer.tsx
â”‚   â””â”€â”€ shared/                   # Shared feature components
â”‚       â”œâ”€â”€ data-table.tsx
â”‚       â””â”€â”€ file-upload.tsx
â”‚
â”œâ”€â”€ features/                     # Feature modules
â”‚   â”œâ”€â”€ users/
â”‚   â”‚   â”œâ”€â”€ components/
â”‚   â”‚   â”‚   â”œâ”€â”€ user-card.tsx
â”‚   â”‚   â”‚   â”œâ”€â”€ user-form.tsx
â”‚   â”‚   â”‚   â””â”€â”€ user-list.tsx
â”‚   â”‚   â”œâ”€â”€ hooks/
â”‚   â”‚   â”‚   â””â”€â”€ use-users.ts
â”‚   â”‚   â”œâ”€â”€ services/
â”‚   â”‚   â”‚   â””â”€â”€ user-service.ts
â”‚   â”‚   â”œâ”€â”€ types/
â”‚   â”‚   â”‚   â””â”€â”€ user.ts
â”‚   â”‚   â”œâ”€â”€ validations/
â”‚   â”‚   â”‚   â””â”€â”€ user-schema.ts
â”‚   â”‚   â””â”€â”€ index.ts
â”‚   â””â”€â”€ orders/
â”‚       â””â”€â”€ ...
â”‚
â”œâ”€â”€ hooks/                        # Shared hooks
â”‚   â”œâ”€â”€ use-debounce.ts
â”‚   â”œâ”€â”€ use-local-storage.ts
â”‚   â””â”€â”€ use-media-query.ts
â”‚
â”œâ”€â”€ lib/                          # Utilities
â”‚   â”œâ”€â”€ api.ts                    # API client
â”‚   â”œâ”€â”€ utils.ts                  # Helper functions
â”‚   â””â”€â”€ constants.ts              # App constants
â”‚
â”œâ”€â”€ store/                        # Redux store (if used)
â”‚   â”œâ”€â”€ store.ts
â”‚   â”œâ”€â”€ hooks.ts
â”‚   â””â”€â”€ slices/
â”‚       â””â”€â”€ cart-slice.ts
â”‚
â”œâ”€â”€ types/                        # Shared types
â”‚   â”œâ”€â”€ api.ts
â”‚   â””â”€â”€ common.ts
â”‚
â””â”€â”€ providers/                    # React context providers
    â”œâ”€â”€ theme-provider.tsx
    â””â”€â”€ query-provider.tsx
```

## Architectural Patterns

### Component Architecture

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Page Component                    â”‚
â”‚  (src/app/users/page.tsx)                           â”‚
â”‚  - Server Component (default)                        â”‚
â”‚  - Data fetching                                     â”‚
â”‚  - SEO metadata                                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚
                         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚               Feature Components                     â”‚
â”‚  (src/features/users/components/)                   â”‚
â”‚  - Client Components when needed                     â”‚
â”‚  - Business logic                                    â”‚
â”‚  - Feature-specific UI                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚
                         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                  UI Components                       â”‚
â”‚  (src/components/ui/)                               â”‚
â”‚  - Reusable primitives                               â”‚
â”‚  - No business logic                                 â”‚
â”‚  - Highly composable                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Data Flow

<Tabs items={["ğŸ–¥ï¸ Server", "ğŸ–±ï¸ Client", "ğŸ”€ Hybrid"]}>
  <Tab value="Server Components">
```tsx
// src/app/users/page.tsx
// Server Component - fetches data on server
import { UserList } from "@/features/users/components/user-list";

async function getUsers() {
const res = await fetch(`${process.env.API_URL}/users`, {
next: { revalidate: 60 }, // ISR
});
return res.json();
}

export default async function UsersPage() {
  const users = await getUsers();

return (

<main>
  <h1>Users</h1>
  <UserList users={users} />
</main>
); }

````
</Tab>
  <Tab value="Client Components">
```tsx
// src/features/users/components/user-list.tsx
"use client";

import { useUsers } from "../hooks/use-users";
import { UserCard } from "./user-card";

export function UserList() {
  const { data: users, isLoading, error } = useUsers();

  if (isLoading) return <UserListSkeleton />;
  if (error) return <ErrorState error={error} />;
  if (!users?.length) return <EmptyState />;

  return (
    <div className="grid gap-4">
      {users.map((user) => (
        <UserCard key={user.id} user={user} />
      ))}
    </div>
  );
}
````

</Tab>
  <Tab value="ğŸ”€ Hybrid">
```tsx
// src/app/users/page.tsx
// Server Component with client children
import { Suspense } from "react";
import { UserFilters } from "@/features/users/components/user-filters";
import { UserListServer } from "@/features/users/components/user-list-server";
import { UserListSkeleton } from "@/features/users/components/user-list-skeleton";

interface Props {
searchParams: { search?: string; role?: string };
}

export default function UsersPage({ searchParams }: Props) {
  return (
    <main>
      <h1>Users</h1>
      {/* Client Component for interactivity */}
      <UserFilters />
      {/* Server Component with Suspense */}
      <Suspense fallback={<UserListSkeleton />}>
        <UserListServer filters={searchParams} />
      </Suspense>
    </main>
  );
}
```
</Tab>
</Tabs>

### State Management Strategy

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        State Types                              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ UI State    â”‚  â”‚ Server Stateâ”‚  â”‚ Application State       â”‚ â”‚
â”‚  â”‚             â”‚  â”‚             â”‚  â”‚                         â”‚ â”‚
â”‚  â”‚ - Modal     â”‚  â”‚ - API Data  â”‚  â”‚ - Shopping Cart         â”‚ â”‚
â”‚  â”‚ - Sidebar   â”‚  â”‚ - User Data â”‚  â”‚ - User Preferences      â”‚ â”‚
â”‚  â”‚ - Tabs      â”‚  â”‚ - Lists     â”‚  â”‚ - Feature Flags         â”‚ â”‚
â”‚  â”‚             â”‚  â”‚             â”‚  â”‚                         â”‚ â”‚
â”‚  â”‚ useState    â”‚  â”‚ TanStack    â”‚  â”‚ Redux Toolkit           â”‚ â”‚
â”‚  â”‚ useReducer  â”‚  â”‚ Query       â”‚  â”‚ or Zustand              â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## Feature Module Pattern

Each feature is self-contained with everything it needs:

```
features/users/
â”œâ”€â”€ components/           # Feature UI
â”‚   â”œâ”€â”€ user-card.tsx
â”‚   â”œâ”€â”€ user-form.tsx
â”‚   â”œâ”€â”€ user-list.tsx
â”‚   â””â”€â”€ user-skeleton.tsx
â”œâ”€â”€ hooks/                # Feature hooks
â”‚   â”œâ”€â”€ use-users.ts
â”‚   â”œâ”€â”€ use-user.ts
â”‚   â””â”€â”€ use-create-user.ts
â”œâ”€â”€ services/             # API layer
â”‚   â””â”€â”€ user-service.ts
â”œâ”€â”€ types/                # TypeScript types
â”‚   â””â”€â”€ user.ts
â”œâ”€â”€ validations/          # Zod schemas
â”‚   â””â”€â”€ user-schema.ts
â”œâ”€â”€ utils/                # Feature utilities
â”‚   â””â”€â”€ user-utils.ts
â””â”€â”€ index.ts              # Public exports
```

### Public API (index.ts)

```tsx
// features/users/index.ts
// Only export what other features need

// Components
export { UserCard } from "./components/user-card";
export { UserList } from "./components/user-list";
export { UserForm } from "./components/user-form";

// Hooks
export { useUsers } from "./hooks/use-users";
export { useUser } from "./hooks/use-user";
export { useCreateUser } from "./hooks/use-create-user";

// Types
export type { User, CreateUserInput, UpdateUserInput } from "./types/user";

// Validations
export { userSchema, createUserSchema } from "./validations/user-schema";
```

## API Architecture

### API Client

```tsx
// src/lib/api.ts
import { getSession } from "next-auth/react";

const BASE_URL = process.env.NEXT_PUBLIC_API_URL;

class ApiError extends Error {
  constructor(public status: number, message: string) {
    super(message);
    this.name = "ApiError";
  }
}

async function getAuthHeaders(): Promise<HeadersInit> {
  const session = await getSession();
  const headers: HeadersInit = {
    "Content-Type": "application/json",
  };

  if (session?.accessToken) {
    headers.Authorization = `Bearer ${session.accessToken}`;
  }

  return headers;
}

async function handleResponse<T>(response: Response): Promise<T> {
  if (!response.ok) {
    if (response.status === 401) {
      // Handle unauthorized
      window.location.href = "/login";
    }
    throw new ApiError(response.status, response.statusText);
  }
  return response.json();
}

export const api = {
  async get<T>(endpoint: string): Promise<T> {
    const headers = await getAuthHeaders();
    const response = await fetch(`${BASE_URL}${endpoint}`, {
      method: "GET",
      headers,
    });
    return handleResponse<T>(response);
  },

  async post<T>(endpoint: string, data?: unknown): Promise<T> {
    const headers = await getAuthHeaders();
    const response = await fetch(`${BASE_URL}${endpoint}`, {
      method: "POST",
      headers,
      body: data ? JSON.stringify(data) : undefined,
    });
    return handleResponse<T>(response);
  },

  async patch<T>(endpoint: string, data?: unknown): Promise<T> {
    const headers = await getAuthHeaders();
    const response = await fetch(`${BASE_URL}${endpoint}`, {
      method: "PATCH",
      headers,
      body: data ? JSON.stringify(data) : undefined,
    });
    return handleResponse<T>(response);
  },

  async delete<T>(endpoint: string): Promise<T> {
    const headers = await getAuthHeaders();
    const response = await fetch(`${BASE_URL}${endpoint}`, {
      method: "DELETE",
      headers,
    });
    return handleResponse<T>(response);
  },
};
```

### Service Layer

```tsx
// features/users/services/user-service.ts
import { api } from "@/lib/api";
import { userSchema, usersSchema } from "../validations/user-schema";
import type { User, CreateUserInput } from "../types/user";

export const userService = {
  async getUsers(): Promise<User[]> {
    const data = await api.get<unknown>("/users");
    return usersSchema.parse(data);
  },

  async getUser(id: string): Promise<User> {
    const data = await api.get<unknown>(`/users/${id}`);
    return userSchema.parse(data);
  },

  async createUser(data: CreateUserInput): Promise<User> {
    const response = await api.post<unknown>("/users", data);
    return userSchema.parse(response);
  },

  async updateUser(id: string, data: Partial<User>): Promise<User> {
    const response = await api.patch<unknown>(`/users/${id}`, data);
    return userSchema.parse(response);
  },

  async deleteUser(id: string): Promise<void> {
    await api.delete(`/users/${id}`);
  },
};
```

## Error Handling

### Error Boundary Pattern

```tsx
// src/components/error-boundary.tsx
"use client";

import { Component, ReactNode } from "react";

interface Props {
  children: ReactNode;
  fallback?: ReactNode;
}

interface State {
  hasError: boolean;
  error?: Error;
}

export class ErrorBoundary extends Component<Props, State> {
  state: State = { hasError: false };

  static getDerivedStateFromError(error: Error): State {
    return { hasError: true, error };
  }

  componentDidCatch(error: Error, errorInfo: React.ErrorInfo) {
    console.error("Error caught:", error, errorInfo);
    // Report to error tracking service
  }

  render() {
    if (this.state.hasError) {
      return this.props.fallback || <DefaultErrorFallback />;
    }
    return this.props.children;
  }
}
```

### Next.js Error Pages

```tsx
// src/app/error.tsx
"use client";

interface Props {
  error: Error & { digest?: string };
  reset: () => void;
}

export default function Error({ error, reset }: Props) {
  return (
    <div className="flex min-h-screen flex-col items-center justify-center">
      <h2 className="text-2xl font-bold">Something went wrong!</h2>
      <p className="text-muted-foreground">{error.message}</p>
      <button onClick={reset} className="mt-4">
        Try again
      </button>
    </div>
  );
}
```

## Performance Patterns

### Code Splitting

```tsx
import dynamic from "next/dynamic";

// Lazy load heavy components
const Chart = dynamic(() => import("@/components/chart"), {
  loading: () => <ChartSkeleton />,
  ssr: false, // Disable SSR for client-only components
});

// Lazy load based on viewport
const LazySection = dynamic(() => import("./lazy-section"), {
  loading: () => <SectionSkeleton />,
});
```

### Image Optimization

```tsx
import Image from "next/image";

// Always use Next.js Image component
<Image
  src="/hero.jpg"
  alt="Hero image"
  width={1200}
  height={600}
  priority // For above-the-fold images
  placeholder="blur"
  blurDataURL={blurDataUrl}
/>;
```

## Decision Records

### Why Next.js App Router?

- **Server Components** - Better performance, smaller bundles
- **Streaming** - Progressive rendering with Suspense
- **Layouts** - Nested layouts with shared state
- **Parallel Routes** - Complex UI patterns
- **Intercepting Routes** - Modal patterns

### Why TanStack Query over Redux for Server State?

- **Built-in caching** - Automatic request deduplication
- **Background updates** - Stale-while-revalidate
- **Optimistic updates** - Better UX for mutations
- **DevTools** - Excellent debugging experience
- **Less boilerplate** - Simpler than Redux Thunk/Saga

### Why Zod for Validation?

- **TypeScript-first** - Automatic type inference
- **Runtime validation** - Catch errors from APIs
- **Composable** - Build complex schemas from simple ones
- **Error messages** - Customizable, user-friendly errors
